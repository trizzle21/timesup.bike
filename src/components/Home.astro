---
import home from '../content/home.json';

const emailPattern = /[\w.+-]+@[\w.-]+\.[A-Za-z]{2,}/g;
const supportUrl = 'https://times-up.org/support/';
const keywordLinks = [
	{
		text: 'Membership Page',
		href: supportUrl,
		attrs: { rel: 'noreferrer noopener', target: '_blank' },
	},
];

const linkifyText = (text) => {
	const segments = [];
	let cursor = 0;

	const getNextMatch = (start) => {
		let nextMatch = { index: Infinity };

		emailPattern.lastIndex = start;
		const emailMatch = emailPattern.exec(text);
		if (emailMatch) {
			nextMatch = {
				type: 'email',
				value: emailMatch[0],
				index: emailMatch.index,
				length: emailMatch[0].length,
			};
		}

		const keywordMatch = keywordLinks
			.map((item) => ({
				type: 'link',
				value: item.text,
				href: item.href,
				attrs: item.attrs,
				index: text.indexOf(item.text, start),
				length: item.text.length,
			}))
			.filter((item) => item.index !== -1)
			.sort((a, b) => a.index - b.index)[0];

		if (keywordMatch && keywordMatch.index < nextMatch.index) {
			return keywordMatch;
		}

		return nextMatch.index !== Infinity ? nextMatch : null;
	};

	while (cursor < text.length) {
		const match = getNextMatch(cursor);

		if (!match) {
			segments.push({ type: 'text', value: text.slice(cursor) });
			break;
		}

		if (match.index > cursor) {
			segments.push({ type: 'text', value: text.slice(cursor, match.index) });
		}

		segments.push(match);
		cursor = match.index + match.length;
	}

	emailPattern.lastIndex = 0;
	return segments;
};

const {gallery} = home;
---

<section id="home" class="home">
	<div class="hero-side">
		<img src="/TU_logo.svg" alt="" class="watermark" aria-hidden="true" />
		<h1>Time's Up! Bike Co-op</h1>
		<p class="tagline">A volunteer-driven space in the East Village for accessible bicycle repair.  Fix your bike or just chit chat about it</p>

		<div class="hero-info">
			<p><strong>How It Works?</strong><br />Bring your bike, sign in and explain the issue to the volunteer mechanic.  They will provide the tools and guidance but you will be hands on with the bike.  Suggested $2 donation covers tool use and supplies.  We also sell used parts onsite, <a href="https://www.canva.com/design/DAGpoE5WunE/sd7Tocqw9nuRl_IhE9WkWA/view?utm_content=DAGpoE5WunE&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hacf7432243">parts pricing</a></p>
			<div class="helpful-tips">
				<strong>Helpful Tips</strong>
				<ul>
					<li>Come early. Fixing one problem sometimes uncovers another</li>
					<li>No new projects 30 minutes before closing</li>
					<li>No e-bike servicing</li>
					<li>Check our <a href="https://www.instagram.com/times_up_nyc/">Instagram</a> for holiday/inclement weather hours and special events</li>
				</ul>
			</div>
			<p><strong>Open Hours</strong><br />Wed & Sun, 5pm â€“ 8pm</p>
			<p><strong>Location</strong><br /><a href="https://maps.app.goo.gl/ejnQJXa6CUUtb12R9" rel="noreferrer noopener" target="_blank">626 E 14th St, New York, NY 10009</a></p>
			<p><strong>Contact Us</strong><br /><a href="mailto:contact@timesup.bike">contact@timesup.bike</a></p>
		</div>

		<footer class="hero-footer">
			<a href="https://www.instagram.com/times_up_nyc/" rel="noreferrer noopener" target="_blank" title="Instagram">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
			</a>
			<a href="https://account.venmo.com/u/timesup" rel="noreferrer noopener" target="_blank" title="Venmo">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19.5 3c.9 1.5 1.3 3 1.3 4.9 0 6.1-5.2 14-9.4 19.6H4.4L1.2 4.1l6.5-.6 1.8 14.5c1.7-2.8 3.8-7.1 3.8-10.1 0-1.8-.3-3-0.8-4L19.5 3z"/></svg>
			</a>
			<a href="https://cash.app/$TIMESUPNYC" rel="noreferrer noopener" target="_blank" title="Cash App">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09v1.27h-2.82v-1.21c-1.63-.24-3.04-1.05-3.5-2.29l1.79-.72c.36.89 1.28 1.5 2.5 1.5 1.17 0 1.87-.53 1.87-1.34 0-.79-.56-1.17-1.91-1.57l-.67-.21c-1.89-.57-3.06-1.44-3.06-3.15 0-1.62 1.22-2.78 3.02-3.06V6.64h2.82v1.15c1.27.23 2.3.89 2.77 1.89l-1.7.85c-.31-.6-.98-1.08-1.86-1.08-.97 0-1.56.47-1.56 1.15 0 .66.52 1.02 1.65 1.36l.67.21c2.1.63 3.32 1.54 3.32 3.38 0 1.76-1.34 2.95-3.33 3.17z"/></svg>
			</a>
			<a href="https://times-up.org/" rel="noreferrer noopener" target="_blank" title="Times-up.org">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
			</a>
		</footer>
	</div>

	<div class="gallery-side">
		{(() => {
			const allImages = [...gallery.images];
			const cols = [[], [], []];
			allImages.forEach((img, i) => cols[i % 3].push(img));
			return cols.map((col) => (
				<div class="gallery-col">
					{col.map((image) => (
						<div class="gallery-item">
							<img src={image.src} alt={image.alt} loading="lazy" />
							<div class="gallery-overlay">
								<p>{image.alt}</p>
							</div>
						</div>
					))}
				</div>
			));
		})()}
	</div>
</section>


<style>
	.home {
		display: flex;
		min-height: 100vh;
		overflow-x: hidden;
	}

	.hero-side {
		width: 35vw;
		padding: 80px 48px;
		display: flex;
		flex-direction: column;
		justify-content: flex-start;
		background: var(--site-bg);
		position: fixed;
		top: 0;
		left: 0;
		height: 100vh;
		overflow: hidden;
		box-sizing: border-box;
	}

	.watermark {
		position: absolute;
		top: 50px;
		left: -10px;
		width: 750px;
		opacity: 0.10;
		pointer-events: none;
		z-index: 0;
		transform: rotate(-15deg);
	}

	.hero-side h1 {
		font-size: 50px;
		font-weight: 700;
		line-height: 1.1;
		margin: 0 0 16px;
		color: var(--text-dark);
		font-family: 'Inter', sans-serif;
		position: relative;
		z-index: 1;
	}

	.tagline {
		font-size: 18px;
		color: var(--text-light);
		margin: 0 0 48px;
		letter-spacing: 0.02em;
		position: relative;
		z-index: 1;
	}

	.hero-nav {
		display: flex;
		flex-direction: column;
		gap: 12px;
		margin-bottom: 48px;
	}

	.hero-nav a {
		font-size: 18px;
		color: var(--text-dark);
		text-decoration: none;
		transition: color 0.2s;
	}

	.hero-nav a:hover {
		color: var(--primary);
	}

	.hero-info {
		display: flex;
		flex-direction: column;
		gap: 16px;
		position: relative;
		z-index: 1;
	}

	.hero-info p {
		margin: 0;
		font-size: 18px;
		color: var(--text-gray);
		line-height: 1.5;
	}

	.hero-info strong {
		color: var(--text-dark);
	}

	.hero-info a {
		color: var(--primary);
		text-decoration: none;
		transition: color 0.2s ease;
	}

	.hero-info a:hover {
		color: var(--primary-dark);
		text-decoration: underline;
	}

	.helpful-tips {
		font-size: 18px;
		color: var(--text-gray);
	}

	.helpful-tips ul {
		margin: 8px 0 0;
		padding-left: 20px;
		line-height: 1.6;
	}

	.helpful-tips li {
		margin-bottom: 4px;
	}

	.hero-footer {
		position: absolute;
		bottom: 48px;
		left: 48px;
		right: 48px;
		display: flex;
		flex-wrap: wrap;
		gap: 16px 24px;
		z-index: 1;
	}

	.hero-footer a {
		color: var(--text-gray);
		text-decoration: none;
		transition: color 0.2s ease;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.hero-footer a:hover {
		color: var(--primary);
	}

	.hero-footer svg {
		width: 32px;
		height: 32px;
	}

	.gallery-side {
		width: 65vw;
		margin-left: 35vw;
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 12px;
		padding: 16px;
		box-sizing: border-box;
	}

	.gallery-col {
		display: flex;
		flex-direction: column;
		gap: 12px;
	}

	.gallery-item {
		border-radius: 12px;
		overflow: hidden;
		aspect-ratio: 16 / 10;
		position: relative;
		cursor: pointer;
	}

	.gallery-item img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
		transition: transform 0.3s ease;
	}

	.gallery-overlay {
		position: absolute;
		inset: 0;
		background: rgba(0, 0, 0, 0.6);
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 16px;
		opacity: 0;
		transition: opacity 0.3s ease;
	}

	.gallery-overlay p {
		color: #fff;
		font-size: 20px;
		text-align: center;
		margin: 0;
		line-height: 1.4;
	}

	.gallery-item:hover .gallery-overlay {
		opacity: 1;
	}

	.gallery-item:hover img {
		transform: scale(1.05);
	}


	@media screen and (max-width: 1024px) {
		.home {
			flex-direction: column;
		}

		.hero-side {
			position: relative;
			width: 100%;
			height: auto;
			padding: 60px 32px;
		}

		.hero-side h1 {
			font-size: 44px;
		}

		.gallery-side {
			width: 100%;
			margin-left: 0;
		}

		.hero-footer {
			position: relative;
			bottom: auto;
			left: auto;
			right: auto;
			margin-top: 32px;
		}
	}

	@media screen and (max-width: 640px) {
		.hero-side {
			padding: 48px 24px 80px;
		}

		.hero-footer {
			margin-top: 24px;
		}

		.hero-side h1 {
			font-size: 36px;
		}

		.tagline {
			margin-bottom: 32px;
		}

		.hero-nav {
			margin-bottom: 32px;
		}

		.gallery-side {
			grid-template-columns: repeat(2, 1fr);
		}
	}
</style>
