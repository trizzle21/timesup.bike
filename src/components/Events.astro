---
import eventsData from '../content/events.json';

const sourceEvents = Array.isArray(eventsData?.events) ? eventsData.events : [];
const formattedEvents = sourceEvents.map((event) => {
	const descriptionLines = event.description.trim().split('\n').map((line) => line.trim());
	const lastLine = descriptionLines[descriptionLines.length - 1] ?? '';
	const hasTerminalPunctuation = /[.!?]$/.test(lastLine);

	return {
		...event,
		descriptionLines,
		hasTerminalPunctuation,
	};
});
---

<section id="events" class="page-section">
	<div class="wrapper">
		<h2>Upcoming Events</h2>
		<p class="lead">
			All events, bike rides, workshops, and pop-up exhibits are free and open to all; feel free to
			bring friends and share widely! Join our community across the city and help spread the word.
		</p>
		<div class="event-grid">
			{formattedEvents.map((event) => (
				<article class="event-card">
					<header class="event-header">
						<h3>{event.title}</h3>
						<p class="event-date">
							<span class="event-day">{event.day}</span>
							<span class="event-time">{event.time}</span>
						</p>
					</header>
					<p class="event-meta">{event.location}</p>
					<p class="event-description">
						{event.descriptionLines.map((line, index) => (
							<>
								{line}
								{index < event.descriptionLines.length - 1 && <br />}
							</>
						))}
						{event.link && (
							<>
								{event.hasTerminalPunctuation ? '' : '.'}{' '}
								<a href={event.link.url} target="_blank" rel="noreferrer">{event.link.label}</a>.
							</>
						)}
					</p>
				</article>
			))}
		</div>
	</div>
</section>

<style>
	#events {
		padding: 80px 32px 120px;
		display: flex;
		justify-content: center;
	}

	.wrapper {
		max-width: 1000px;
		width: 100%;
	}

	h2 {
		margin: 0 0 16px;
		font-size: 36px;
		font-weight: 700;
		color: var(--text-dark);
		text-align: center;
	}

	.lead {
		margin: 0 auto 48px;
		max-width: 700px;
		text-align: center;
		color: var(--text-gray);
		font-size: 16px;
		line-height: 1.7;
	}

	.event-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(min(340px, 100%), 1fr));
		gap: 24px;
	}

	.event-card {
		background: var(--surface);
		border-radius: 16px;
		padding: 28px;
		box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
		display: flex;
		flex-direction: column;
		gap: 12px;
		color: var(--text-gray);
	}

	.event-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-start;
		gap: 16px;
	}

	.event-header h3 {
		margin: 0;
		font-size: 20px;
		font-weight: 600;
		color: var(--text-dark);
	}

	.event-date {
		margin: 0;
		display: flex;
		flex-direction: column;
		align-items: flex-end;
		font-size: 14px;
		color: var(--accent);
		font-weight: 600;
		white-space: nowrap;
	}

	.event-meta {
		margin: 0;
		font-size: 14px;
		color: var(--text-light);
		font-weight: 500;
	}

	.event-description {
		margin: 0;
		font-size: 15px;
		line-height: 1.7;
		color: var(--text-gray);
	}

	.event-description a {
		color: var(--primary);
		text-decoration: underline;
		text-decoration-color: rgba(184, 111, 80, 0.3);
		text-underline-offset: 2px;
		font-weight: 500;
		transition: text-decoration-color 0.2s ease;
	}

	.event-description a:hover,
	.event-description a:focus {
		text-decoration-color: var(--primary);
	}

	@media screen and (max-width: 768px) {
		#events {
			padding: 56px 20px 80px;
		}

		h2 {
			font-size: 28px;
		}

		.lead {
			font-size: 15px;
			margin-bottom: 36px;
		}

		.event-card {
			padding: 22px;
		}

		.event-header {
			flex-direction: column;
			align-items: flex-start;
			gap: 8px;
		}

		.event-date {
			align-items: flex-start;
		}
	}
</style>
